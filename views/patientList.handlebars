<div id="filter_container">
  <div id="filter_position">
    <form class="filter">
      <div class="filter_header">
        <label>FILTER</label>
      </div>
      <div>
        <div class="filter_title">
          <label>Priezvisko pacienta</label>
        </div>
        <div>
          <input type="text" id="surname" value="{{surname}}">
        </div>
      </div>
      <div>
        <button class="action_button_2" id="filterBtn">Potvrdiť</button>
      </div>
    </form>

    <form class="filter" method="GET">

      <div class="filter_title">
        <label>Počet pacientov</label>
      </div>

      <div>
        <input type="number" id="numberOfPatients" name="numberOfPatients">
      </div>

      <div>
        <button class="action_button_2" id="excelBtn">Generuj Excel</button>
      </div>

    </form>
  </div>
</div>

<div id="patient_list_container">
  <table id="list">
    <tr class="borders">
      <th>Meno</th>
      <th>Priezvisko</th>
      <th>Dátum narodenia</th>
      <th class="hidden">ID</th>
      <th>Možnosti</th>
    </tr>

    {{#each informations}}
    <tr id="{{@index}}">
      <td id="patientName-{{@index}}">{{this.name}}</td>
      <td id="patientSurname-{{@index}}">{{this.surname}}</td>
      <td id="patientDate-{{@index}}">{{this.birthDate}}</td>
      <td id="patientID-{{@index}}" class="hidden">{{this.ID}}</td>
      <td>
        <button class="showInfo">Zobraziť informácie</button>
        <button class="showQuestionaires">Zobraziť dotazníky</button>
        <button class="updateInfo">Upraviť informácie</button>
        <button class="updateQuestionaires">Upraviť dotazníky</button>
      </td>
    </tr>
    {{/each}}
  </table>
</div>

<script>
  var numberOfRows = $('table tr').length;

  for (var rowNumber = 1; rowNumber < numberOfRows - 1; rowNumber++) {
    if (rowNumber % 2 == 0) {
      document.getElementById(rowNumber).style.backgroundColor = '#FFFFFF';
    } else {
      document.getElementById(rowNumber).style.backgroundColor = '#ACCEE5';
    }
  }

  var getPatientId = function getPatientId(element) {
    var rowID = element.parentNode.parentNode.id;
    var patientId = document.getElementById('patientID-' + rowID).textContent;
    return patientId;
  };

  $(".showInfo").each(function () {
    $(this).click(function () {
      window.location = '/informacie_o_pacientovi?pacient=' + getPatientId(this);
    })
  });

  $(".updateInfo").each(function () {
    $(this).click(function () {
      window.location = '/uprava_pacienta?pacient=' + getPatientId(this);
    })
  });

  $(".showQuestionaires").each(function () {
    $(this).click(function () {
      window.location = '/zoznam_dotaznikov_pacienta?pacient=' + getPatientId(this);
    })
  });

  $(".updateQuestionaires").each(function () {
    $(this).click(function () {
      window.location = '/vyber_dotaznika?pacient=' + getPatientId(this);
    })
  })

  $('#filterBtn').click(function (e) {
    e.preventDefault();

    var surname = $('#surname').val();
    var url = '/zoznam_pacientov?surname=' + encodeURIComponent(surname);
    window.location = url;
  });

  $("#excelBtn").click(function (e) {
    e.preventDefault();

    var formValues = {
      numberOfPacients: $('#numberOfPatients').val(),
      surname: $('#surname').val()
    };

    console.log(formValues);
    $.ajax({
      type: 'POST',
      url: '/generuj_excel',
      data: JSON.stringify(formValues),
      contentType: 'application/json',
      dataType: 'json',
      success: function (data, status) {
        console.log(data)
      },
      error: function (error) {
        alert('Pri vytvarani excelu vznikla chyba');
      }
    })
  });
</script>